window.onload=function(){const t=(t,e)=>{const s=Math.pow(e.get("x_pos")-t.get("x_pos"),2),i=Math.pow(e.get("y_pos")-t.get("y_pos"),2);return Math.sqrt(s+i)};class e{constructor(t,e,s,i,o,h,a){this.x_pos=t,this.y_pos=e,this.height=s,this.width=i,this.symbol=o,this.alive=a,this.symbolType=h}set(t,e){this[t]=e}get(t){return this[t]}destroyed(){this.alive=!1,this.symbol=""}}class s extends e{constructor(t,e,s,i,o,h,a){super(t,e,s,i,o,h,a),this.alive=a,this.ammo=10,this.speed=0,this.backspeed=0,this.acceleration=0,this.start_x_pos=t}shoot(t){if(this.ammo<=0)return;this.ammo-=1;const e=new i(this.x_pos,this.y_pos+22,1,1,".","char",!0);t.addObject(e)}addAmmo(t){this.ammo<10&&(this.ammo+=t,this.ammo=this.ammo>10?10:this.ammo)}move(t){this.y_pos=this.y_pos+.01*this.height*t}accelerate(){this.acceleration=this.acceleration+.2,this.x_pos<20*this.start_x_pos&&(this.speed=.1*this.acceleration,this.x_pos=this.x_pos+this.speed)}break(t){this.backspeed=this.backspeed||.1,t&&this.backspeed>0&&(this.backspeed=.5),this.acceleration>=4&&(this.acceleration=0),this.x_pos>this.start_x_pos&&!(this.x_pos<=0)&&(this.backspeed=1.1*this.backspeed- -.5*this.backspeed,this.x_pos=this.x_pos-this.backspeed),this.backspeed=0}}class i extends e{constructor(t,e,s,i,o,h,a){super(t,e,s,i,o,h,a),this.alive=a}}class o extends e{constructor(t,e,s,i,o,h,a){super(t,e,s,i,o,h,a),this.y_pos=Math.round(Math.random()*e),this.x_pos=t,this.direction=1,this.alive=a}move(){this.y_pos<a.gameWindow.height&&(this.y_pos=this.y_pos+1*this.direction),this.y_pos>a.gameWindow.height-this.height&&(this.direction=-1,this.y_pos=this.y_pos+1*this.direction),this.y_pos<50&&(this.direction=1,this.y_pos=this.y_pos+1*this.direction),this.x_pos=this.x_pos-1}}class h{constructor(t,e){if("object"==typeof h.instance)return h.instance;this.stop=!1,document.getElementById("gameWindow").height=t,document.getElementById("gameWindow").width=e,this.gameWindow=document.getElementById("gameWindow"),this.background=[];for(let t=0;t<2;t+=1)this.background.push({image:document.getElementById("bg"),x_pos:0});this.background[1].x_pos=this.gameWindow.width-2,this.bg_x_pos=0,this.canvas=this.gameWindow.getContext("2d"),this.canvas.font="25px Consolas",this.objectRepository=[],this.highscore=0}setResolution(t){switch(t){case 1:this.gameWindow.height=786,this.gameWindow.width=1024;break;case 2:this.gameWindow.height=720,this.gameWindow.width=1280}}addObject(t){this.objectRepository.push(t)}removeObject(t){}getObjectInstance(t){return this.objectRepository[t]}drawBackground(){this.background[0].x_pos=this.background[0].x_pos-.5,this.canvas.drawImage(this.background[0].image,this.background[0].x_pos,0,this.gameWindow.width,this.gameWindow.height),this.background[1].x_pos=this.background[1].x_pos-.5,this.canvas.drawImage(this.background[1].image,this.background[1].x_pos,0,this.gameWindow.width,this.gameWindow.height),this.background[0].x_pos<=0-this.gameWindow.width&&(this.background.shift(),this.background.push({image:document.getElementById("bg"),x_pos:this.gameWindow.width-2}))}refresh(){this.stop||(this.canvas.clearRect(0,0,this.gameWindow.width,this.gameWindow.height),this.drawBackground(),this.objectRepository.forEach(t=>{let e=t.get("x_pos"),s=t.get("y_pos");s>=this.gameWindow.height-20&&(s-=20),s<=10&&(s+=20),t.set("y_pos",s),this.canvas.strokeText(` Score: ${this.highscore}`,400,20),"img"===t.symbolType&&this.canvas.drawImage(t.get("symbol"),e,s),"char"===t.symbolType&&this.canvas.strokeText(t.get("symbol"),e,s),void 0!==t.ammo&&this.canvas.strokeText("Ammo: "+t.get("ammo")+" / 10",0,20)}))}gameOver(){this.stop=!0,this.canvas.clearRect(0,0,this.gameWindow.width,this.gameWindow.height),this.drawBackground(),this.canvas.font="100px Arial";var t=ctx.createLinearGradient(0,0,c.width,0);t.addColorStop("0","#990000"),t.addColorStop("0.5","#CC0000"),t.addColorStop("1.0","#FF3333"),this.canvas.fillStyle=t,this.canvas.fillText("Game OVER!",.1*this.gameWindow.width,.25*this.gameWindow.height),this.canvas.fillText(`Highscore: ${this.highscore}`,.1*this.gameWindow.width,.5*this.gameWindow.height)}}const a=new h(400,1e3),n=new s(.025*a.gameWindow.height,a.gameWindow.height/2,.5*a.gameWindow.height,.5*a.gameWindow.height,document.getElementById("vehicle"),"img",!0);function d(t,e){for(let s=0;s<=t-1;s+=1){e+=50;const t=new o(a.gameWindow.width-e,a.gameWindow.height,50,50,document.getElementById("ufo"),"img",!0);a.addObject(t)}}d(2,50),a.addObject(n);let r={};document.addEventListener("keydown",function(t){r[t.key]=!0," "!==t.key&&(r[t.key]=!0)}),document.addEventListener("keypress",function(t){" "===t.key&&n.shoot(a)}),document.addEventListener("keyup",function(t){delete r[t.key]});let g=4;this.gameOver=!1;const m=setInterval(function(){n.x_pos>n.start_x_pos&&!r.ArrowRight&&n.break(),r.ArrowUp&&n.move(-1),r.ArrowDown&&n.move(1),r.ArrowRight&&n.accelerate(),r.ArrowLeft&&n.break(!0);let e=[],h=[];for(let t=0;t<=a.objectRepository.length;t+=1){let s=a.objectRepository[t];s instanceof o&&h.push(s),s instanceof i&&e.push(s)}e.length>=1&&e.forEach((t,e)=>{t.x_pos=t.x_pos+.01*n.height}),h.forEach(s=>{s.move(),t(n,s)<=.59*s.height&&n.alive&&!s.alive&&(s.set("symbolType","char"),a.highscore=a.highscore+5,s.set("symbol",""),n.addAmmo(1)),t(n,s)<=.59*s.height&&n.alive&&s.alive&&(a.highscore=a.highscore-10),e.forEach((e,i)=>{t(e,s)<=.25*s.height&&e.alive&&s.alive&&(e.set("symbol"," "),e.alive=!1,a.highscore=a.highscore+10,s.set("symbol",document.getElementById("ammo")),s.alive=!1)})}),a.objectRepository=a.objectRepository.filter(t=>t instanceof o&&t.x_pos>0?t:!0===t.alive?t:t instanceof i&&t.x_pos<a.gameWindow.width?t:t instanceof s?t:void 0);const c=a.objectRepository.filter(t=>{if(t instanceof o&&t.x_pos>0)return t}).length;0===c&&(d(g,50),g=Math.round(1.2*g)),c>0&&h.forEach(t=>{if(t.x_pos<0)return a.gameOver(),h=[],void clearInterval(m)}),a.refresh()},10)};