window.onload=function(){const t=(t,e)=>t.x_pos<e.x_pos+e.width&&t.x_pos+t.width>e.x_pos&&t.y_pos<e.y_pos+e.height&&t.y_pos+t.height>e.y_pos;class e{constructor(t,e,s,i,o,h,a){this.x_pos=t,this.y_pos=e,this.height=s,this.width=i,this.symbol=o,this.alive=a,this.symbolType=h}set(t,e){this[t]=e}get(t){return this[t]}destroyed(){this.alive=!1,this.symbol=""}}class s extends e{constructor(t,e,s,i,o,h,a){super(t,e,s,i,o,h,a),this.alive=a,this.ammo=10,this.speed=0,this.backspeed=0,this.acceleration=0,this.start_x_pos=t,this.shield=!1,this.shieldPower=100}shoot(t){if(this.ammo<=0)return;this.ammo-=1;const e=new i(this.x_pos,this.y_pos+22,15,2,document.getElementById("shot"),"img",!0,!0);t.addObject(e)}addAmmo(t){this.ammo<10&&(this.ammo+=t,this.ammo=this.ammo>10?10:this.ammo)}move(t){this.y_pos=this.y_pos+.05*this.height*t}accelerate(){this.acceleration=this.acceleration+.4,this.x_pos<20*this.start_x_pos&&(this.speed=.1*this.acceleration,this.x_pos=this.x_pos+this.speed),this.symbol=document.getElementById("vehicle_faster")}break(t){this.symbol=document.getElementById("vehicle"),this.backspeed=this.backspeed||.1,t&&this.backspeed>0&&(this.backspeed=1.1),this.acceleration>=4&&(this.acceleration=0),this.x_pos>this.start_x_pos&&!(this.x_pos<=0)&&(this.backspeed=1.2*this.backspeed- -.5*this.backspeed,this.x_pos=this.x_pos-this.backspeed),this.backspeed=0}activateShield(t){console.log(t),t&&0===this.acceleration&&this.shieldPower>=1?(this.shield=!0,this.symbol=document.getElementById("vehicle_shield"),this.shieldPower=this.shieldPower-1):(this.shield=!1,this.symbol=document.getElementById("vehicle"))}}class i extends e{constructor(t,e,s,i,o,h,a,n){super(t,e,s,i,o,h,a),this.alive=a,this.isAmmoOfhero=n}}class o extends e{constructor(t,e,s,i,o,h,a){super(t,e,s,i,o,h,a),this.y_pos=Math.round(Math.random()*e),this.x_pos=t,this.direction=1,this.alive=a,this.itemTaken=!1}move(){this.y_pos<a.gameWindow.height&&(this.y_pos=this.y_pos+1*this.direction),this.y_pos>a.gameWindow.height-this.height&&(this.direction=-1,this.y_pos=this.y_pos+1*this.direction),this.y_pos<50&&(this.direction=1,this.y_pos=this.y_pos+1*this.direction),this.x_pos=this.x_pos-1}shoot(t,e,s){100*Math.random()>99.8&&this.alive&&s.addObject(new i(this.x_pos,this.y_pos+22,15,2,document.getElementById("shot_enemy1"),"img",!0,!1))}}class h{constructor(t,e){if("object"==typeof h.instance)return h.instance;this.stop=!1,document.getElementById("gameWindow").height=t,document.getElementById("gameWindow").width=e,this.gameWindow=document.getElementById("gameWindow"),this.background=[];for(let t=0;t<2;t+=1)this.background.push({image:document.getElementById("bg"),x_pos:0});this.background[1].x_pos=this.gameWindow.width-2,this.bg_x_pos=0,this.canvas=this.gameWindow.getContext("2d"),this.canvas.font="25px Consolas",this.objectRepository=[],this.highscore=0,this.health=100}setResolution(t){switch(t){case 1:this.gameWindow.height=786,this.gameWindow.width=1024;break;case 2:this.gameWindow.height=720,this.gameWindow.width=1280}}addObject(t){this.objectRepository.push(t)}removeObject(t){}getObjectInstance(t){return this.objectRepository[t]}drawBackground(){this.background[0].x_pos=this.background[0].x_pos-.5,this.canvas.drawImage(this.background[0].image,this.background[0].x_pos,0,this.gameWindow.width,this.gameWindow.height),this.background[1].x_pos=this.background[1].x_pos-.5,this.canvas.drawImage(this.background[1].image,this.background[1].x_pos,0,this.gameWindow.width,this.gameWindow.height),this.background[0].x_pos<=0-this.gameWindow.width&&(this.background.shift(),this.background.push({image:document.getElementById("bg"),x_pos:this.gameWindow.width-2}))}drawBar(t,e,s){this.canvas.beginPath(),this.canvas.lineWidth="10",this.canvas.strokeStyle="red",this.canvas.rect(t-110,10,100,10),this.canvas.stroke(),this.canvas.beginPath(),this.canvas.lineWidth="10",this.canvas.strokeStyle=s,this.canvas.rect(t-110,10,e,10),this.canvas.stroke()}refresh(){this.stop||(this.canvas.clearRect(0,0,this.gameWindow.width,this.gameWindow.height),this.canvas.fillStyle="black",this.drawBackground(),this.objectRepository.forEach(t=>{let e=t.get("x_pos"),s=t.get("y_pos");s>=this.gameWindow.height-20&&(s-=20),s<=10&&(s+=20),t.set("y_pos",s),this.canvas.fillText(` Score: ${this.highscore}`,400,20),"img"===t.symbolType&&this.canvas.drawImage(t.get("symbol"),e,s,t.height,t.width),void 0!==t.ammo&&this.canvas.fillText("Ammo: "+t.get("ammo")+" / 10",10,20),this.drawBar(a.gameWindow.width-140,this.health,"green"),t.shieldPower&&this.drawBar(a.gameWindow.width-10,t.shieldPower,"blue")}))}gameOver(){this.stop=!0,this.drawBackground(),this.canvas.font="100px Arial";var t=this.canvas.createLinearGradient(0,0,this.gameWindow.width,0);t.addColorStop("0","red"),t.addColorStop("0.5","red"),t.addColorStop("1.0","green"),this.canvas.fillStyle=t,this.canvas.fillText("Game OVER!",.1*this.gameWindow.width,.25*this.gameWindow.height),this.canvas.fillText(`Highscore: ${this.highscore}`,.1*this.gameWindow.width,.5*this.gameWindow.height)}}const a=new h(400,1e3),n=new s(.025*a.gameWindow.width,a.gameWindow.height/2,.04*a.gameWindow.width,.05*a.gameWindow.height,document.getElementById("vehicle"),"img",!0);function d(t,e){for(let s=0;s<=t-1;s+=1){e+=50;const t=new o(a.gameWindow.width+e,a.gameWindow.height,.1*a.gameWindow.width/2,.1*a.gameWindow.height,document.getElementById("ufo"),"img",!0);a.addObject(t)}}d(2,50),a.addObject(n);let c={};document.addEventListener("keydown",function(t){console.log(t.key),c[t.key]=!0," "!==t.key&&(c[t.key]=!0)}),document.addEventListener("keypress",function(t){" "===t.key&&n.shoot(a)}),document.addEventListener("keyup",function(t){delete c[t.key]});let r=4;this.gameOver=!1;const m=setInterval(function(){n.x_pos>n.start_x_pos&&!c.ArrowRight&&n.break(),c.ArrowUp&&n.move(-1),c.ArrowDown&&n.move(1),c.ArrowRight&&n.accelerate(),c.ArrowLeft&&n.break(!0),c.Control?n.activateShield(!0):(n.shield=!1,0===n.accelerate&&(n.symbol=document.getElementById("vehicle")),n.shieldPower<100&&(n.shieldPower=n.shieldPower+1));let e=[],h=[];for(let t=0;t<=a.objectRepository.length;t+=1){let s=a.objectRepository[t];s instanceof o&&h.push(s),s instanceof i&&e.push(s)}e.length>=1&&e.forEach((t,e)=>{t.isAmmoOfhero&&(t.x_pos=t.x_pos+.2*n.width),t.isAmmoOfhero||(t.x_pos=t.x_pos-.1*n.width)}),h.forEach(s=>{s.shoot(n,50,a),s.move(),t(n,s)&&n.alive&&!s.alive&&!s.itemTaken&&(s.set("symbolType","char"),s.set("itemTaken",!0),a.highscore=a.highscore+5,s.set("symbol",""),n.addAmmo(1)),t(n,s)&&n.alive&&s.alive&&(a.highscore=a.highscore-10,a.health=a.health-1),e.forEach((e,i)=>{t(e,s)&&e.alive&&e.isAmmoOfhero&&s.alive&&(e.set("symbol",document.getElementById("white")),e.alive=!1,a.highscore=a.highscore+10,s.set("symbol",document.getElementById("ammo")),s.alive=!1),t(e,n)&&e.alive&&!e.isAmmoOfhero&&!n.shield&&(e.set("symbol",document.getElementById("white")),e.alive=!1,a.highscore=a.highscore-5,a.health=a.health-5)})}),a.objectRepository=a.objectRepository.filter(t=>t instanceof o&&t.x_pos>0?t:!0===t.alive?t:t instanceof i&&t.x_pos>0&&t.x_pos<a.gameWindow.width?t:t instanceof s?t:void 0);const l=a.objectRepository.filter(t=>{if(t instanceof o&&t.x_pos>0)return t}).length;0===l&&(d(r,50),r=Math.round(1.2*r)),a.health<=0&&(a.gameOver(),clearInterval(m)),l>0&&h.forEach(t=>{if(t.x_pos<0)return a.gameOver(),h=[],void clearInterval(m)}),a.refresh()},10)};